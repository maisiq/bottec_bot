[32;21m[INFO] 2025-05-31 15:28:03 | aiogram.dispatcher | Start polling (dispatcher.py:566)[0m
[32;21m[INFO] 2025-05-31 15:28:03 | aiogram.dispatcher | Run polling for bot @testasdlklk_bot id=6796632873 - 'test1337' (dispatcher.py:363)[0m
[32;21m[INFO] 2025-05-31 15:28:11 | aiogram.event | Update id=973533536 is not handled. Duration 0 ms by bot id=6796632873 (dispatcher.py:172)[0m
[31;21m[ERROR] 2025-05-31 15:28:11 | aiogram.event | Cause exception while process update id=973533536 by bot id=6796632873
AttributeError: 'NoneType' object has no attribute 'encode' (dispatcher.py:315)[0m
Traceback (most recent call last):
  File "G:\Python\bottec\.venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 309, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "G:\Python\bottec\.venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 158, in feed_update
    response = await self.update.wrap_outer_middleware(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "G:\Python\bottec\.venv\Lib\site-packages\aiogram\dispatcher\middlewares\error.py", line 25, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "G:\Python\bottec\.venv\Lib\site-packages\aiogram\dispatcher\middlewares\user_context.py", line 56, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "G:\Python\bottec\.venv\Lib\site-packages\aiogram\fsm\middleware.py", line 42, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "G:\Python\bottec\.venv\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "G:\Python\bottec\.venv\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "G:\Python\bottec\.venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "G:\Python\bottec\.venv\Lib\site-packages\aiogram\dispatcher\router.py", line 146, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "G:\Python\bottec\.venv\Lib\site-packages\aiogram\dispatcher\router.py", line 141, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "G:\Python\bottec\.venv\Lib\site-packages\aiogram\dispatcher\router.py", line 174, in _propagate_event
    response = await router.propagate_event(update_type=update_type, event=event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "G:\Python\bottec\.venv\Lib\site-packages\aiogram\dispatcher\router.py", line 146, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "G:\Python\bottec\.venv\Lib\site-packages\aiogram\dispatcher\router.py", line 141, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "G:\Python\bottec\.venv\Lib\site-packages\aiogram\dispatcher\router.py", line 166, in _propagate_event
    response = await observer.trigger(event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "G:\Python\bottec\.venv\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "G:\Python\bottec\.venv\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "G:\Python\bottec\bot\src\products\router.py", line 120, in catalog_handler
    await display_page(message, state)
  File "G:\Python\bottec\bot\src\products\router.py", line 58, in display_page
    items = await get_items_by_state(data, cur_state)
            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "G:\Python\bottec\bot\src\products\router.py", line 34, in get_items_by_state
    async with get_connection() as conn:
  File "C:\Users\User\AppData\Local\Programs\Python\Python312\Lib\contextlib.py", line 210, in __aenter__
    return await anext(self.gen)
           ^^^^^^^^^^^^^^^^^^^^^
  File "G:\Python\bottec\bot\src\db\config.py", line 11, in get_connection
    async with await AsyncConnection.connect(POSTGRES_CONNINFO) as conn:
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "G:\Python\bottec\.venv\Lib\site-packages\psycopg\connection_async.py", line 111, in connect
    params = await cls._get_connection_params(conninfo, **kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "G:\Python\bottec\.venv\Lib\site-packages\psycopg\connection_async.py", line 184, in _get_connection_params
    return conninfo_to_dict(conninfo, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "G:\Python\bottec\.venv\Lib\site-packages\psycopg\conninfo.py", line 82, in conninfo_to_dict
    opts = _parse_conninfo(conninfo)
           ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "G:\Python\bottec\.venv\Lib\site-packages\psycopg\conninfo.py", line 101, in _parse_conninfo
    return pq.Conninfo.parse(conninfo.encode())
                             ^^^^^^^^^^^^^^^
AttributeError: 'NoneType' object has no attribute 'encode'
[32;21m[INFO] 2025-05-31 15:28:57 | aiogram.dispatcher | Polling stopped (dispatcher.py:594)[0m
[32;21m[INFO] 2025-05-31 15:28:57 | aiogram.dispatcher | Polling stopped for bot @testasdlklk_bot id=6796632873 - 'test1337' (dispatcher.py:395)[0m
[32;21m[INFO] 2025-05-31 15:29:01 | aiogram.dispatcher | Start polling (dispatcher.py:566)[0m
[32;21m[INFO] 2025-05-31 15:29:02 | aiogram.dispatcher | Run polling for bot @testasdlklk_bot id=6796632873 - 'test1337' (dispatcher.py:363)[0m
[32;21m[INFO] 2025-05-31 15:29:05 | aiogram.event | Update id=973533537 is handled. Duration 422 ms by bot id=6796632873 (dispatcher.py:172)[0m
[32;21m[INFO] 2025-05-31 15:29:08 | aiogram.event | Update id=973533538 is handled. Duration 469 ms by bot id=6796632873 (dispatcher.py:172)[0m
[32;21m[INFO] 2025-05-31 15:29:10 | aiogram.event | Update id=973533539 is handled. Duration 344 ms by bot id=6796632873 (dispatcher.py:172)[0m
[32;21m[INFO] 2025-05-31 15:29:12 | aiogram.event | Update id=973533540 is handled. Duration 485 ms by bot id=6796632873 (dispatcher.py:172)[0m
[32;21m[INFO] 2025-05-31 15:29:14 | aiogram.event | Update id=973533541 is handled. Duration 312 ms by bot id=6796632873 (dispatcher.py:172)[0m
[32;21m[INFO] 2025-05-31 15:29:17 | aiogram.event | Update id=973533542 is handled. Duration 468 ms by bot id=6796632873 (dispatcher.py:172)[0m
[32;21m[INFO] 2025-05-31 15:29:19 | aiogram.event | Update id=973533543 is not handled. Duration 156 ms by bot id=6796632873 (dispatcher.py:172)[0m
[31;21m[ERROR] 2025-05-31 15:29:19 | aiogram.event | Cause exception while process update id=973533543 by bot id=6796632873
TelegramBadRequest: Telegram server says - Bad Request: wrong HTTP URL specified (dispatcher.py:315)[0m
Traceback (most recent call last):
  File "G:\Python\bottec\.venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 309, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "G:\Python\bottec\.venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 158, in feed_update
    response = await self.update.wrap_outer_middleware(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "G:\Python\bottec\.venv\Lib\site-packages\aiogram\dispatcher\middlewares\error.py", line 25, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "G:\Python\bottec\.venv\Lib\site-packages\aiogram\dispatcher\middlewares\user_context.py", line 56, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "G:\Python\bottec\.venv\Lib\site-packages\aiogram\fsm\middleware.py", line 42, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "G:\Python\bottec\.venv\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "G:\Python\bottec\.venv\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "G:\Python\bottec\.venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "G:\Python\bottec\.venv\Lib\site-packages\aiogram\dispatcher\router.py", line 146, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "G:\Python\bottec\.venv\Lib\site-packages\aiogram\dispatcher\router.py", line 141, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "G:\Python\bottec\.venv\Lib\site-packages\aiogram\dispatcher\router.py", line 174, in _propagate_event
    response = await router.propagate_event(update_type=update_type, event=event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "G:\Python\bottec\.venv\Lib\site-packages\aiogram\dispatcher\router.py", line 146, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "G:\Python\bottec\.venv\Lib\site-packages\aiogram\dispatcher\router.py", line 141, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "G:\Python\bottec\.venv\Lib\site-packages\aiogram\dispatcher\router.py", line 166, in _propagate_event
    response = await observer.trigger(event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "G:\Python\bottec\.venv\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "G:\Python\bottec\.venv\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "G:\Python\bottec\bot\src\products\router.py", line 157, in product_detail_handler
    await callback.message.bot.send_photo(
  File "G:\Python\bottec\.venv\Lib\site-packages\aiogram\client\bot.py", line 2920, in send_photo
    return await self(call, request_timeout=request_timeout)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "G:\Python\bottec\.venv\Lib\site-packages\aiogram\client\bot.py", line 478, in __call__
    return await self.session(self, method, timeout=request_timeout)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "G:\Python\bottec\.venv\Lib\site-packages\aiogram\client\session\base.py", line 254, in __call__
    return cast(TelegramType, await middleware(bot, method))
                              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "G:\Python\bottec\.venv\Lib\site-packages\aiogram\client\session\aiohttp.py", line 185, in make_request
    response = self.check_response(
               ^^^^^^^^^^^^^^^^^^^^
  File "G:\Python\bottec\.venv\Lib\site-packages\aiogram\client\session\base.py", line 120, in check_response
    raise TelegramBadRequest(method=method, message=description)
aiogram.exceptions.TelegramBadRequest: Telegram server says - Bad Request: wrong HTTP URL specified
[31;21m[ERROR] 2025-05-31 15:30:01 | apscheduler.executors.default | Job "promote (trigger: interval[0:01:00], next run at: 2025-05-31 15:31:01 +04)" raised an exception (base.py:195)[0m
Traceback (most recent call last):
  File "G:\Python\bottec\.venv\Lib\site-packages\apscheduler\executors\base.py", line 181, in run_coroutine_job
    retval = await job.func(*job.args, **job.kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "G:\Python\bottec\bot\src\tasks\promo.py", line 41, in promote
    promo = await repo.get_active_promo(cur_time)
            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "G:\Python\bottec\bot\src\db\repository.py", line 84, in get_active_promo
    await cur.execute(promo_query, (cur_time,))
  File "G:\Python\bottec\.venv\Lib\site-packages\psycopg\cursor_async.py", line 97, in execute
    raise ex.with_traceback(None)
psycopg.errors.UndefinedColumn: столбец "text_link" не существует
LINE 2:             SELECT id, text, cover, link, text_link
                                                  ^
[32;21m[INFO] 2025-05-31 15:30:10 | aiogram.dispatcher | Polling stopped (dispatcher.py:594)[0m
[32;21m[INFO] 2025-05-31 15:30:10 | aiogram.dispatcher | Polling stopped for bot @testasdlklk_bot id=6796632873 - 'test1337' (dispatcher.py:395)[0m
